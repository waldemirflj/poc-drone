pipeline:
  npm-install:
    image: node:8.15.0-alpine
    commands:
      - cd api/
      - npm install
    when:
      branch: [ develop ]
      event: [ push ]

  npm-test:
    image: node:8.15.0-alpine
    commands:
      - cd api/
      - npm test
    when:
      branch: [ develop ]
      event: [ push ]
  
  npm-version:
    image: node:8.15.0-alpine
    commands:
      # - export VERSION=$(npm version patch)
      - export VERSION=1.0.0
  
  docker-registry-push:
    image: plugins/docker
    repo: waldemirflj/poc-drone
    secrets: [ docker_username, docker_password ]
    dockerfile: Dockerfile
    tags:
      # - $VERSION
      # - latest
      - ${DRONE_COMMIT_SHA}
      # - ${DRONE_COMMIT_BRANCH}
        

